<?xml version="1.0" encoding="UTF-8"?>

<beans:beans xmlns="http://www.springframework.org/schema/security"
             xmlns:beans="http://www.springframework.org/schema/beans"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://www.springframework.org/schema/beans
                                 http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                                 http://www.springframework.org/schema/security
                                 http://www.springframework.org/schema/security/spring-security-3.0.xsd">

    <beans:import resource="applicationContext-business.xml"/>

    <http entry-point-ref="authenticaionEntryPoint">
        <!--replace the default one-->
        <custom-filter before="FORM_LOGIN_FILTER" ref="customizedFormLoginFilter" />

        <!-- public -->
        <intercept-url pattern="/css/**" filters="none" />
        <intercept-url pattern="/images/**" filters="none" />
        <intercept-url pattern="/index.html" filters="none" />
        <intercept-url pattern="/faces/Welcome.xhtml" filters="none" />
        <!-- secure -->
        <intercept-url pattern="/**" access="ROLE_HRS" />


        <logout logout-success-url="/faces/Welcome.xhtml" />

        <!-- Max number of sessions -->
        <!--<session-management>-->
            <!--<concurrency-control max-sessions="1" error-if-maximum-exceeded="true" />-->
        <!--</session-management>-->

    </http>

    <authentication-manager alias="authenticationManager"/>

    <beans:bean id="customizedFormLoginFilter" class="org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter" >
        <beans:property name="authenticationManager" ref="myAuthenticationManager" />
        <beans:property name="authenticationSuccessHandler">
			<beans:bean class="org.springframework.security.web.authentication.SimpleUrlAuthenticationSuccessHandler">
				<beans:property name="defaultTargetUrl" value="/faces/login/Welcome.xhtml" />
				<beans:property name="alwaysUseDefaultTargetUrl" value="true" />
			</beans:bean>
		</beans:property>
		<beans:property name="authenticationFailureHandler">
			<beans:bean class="org.springframework.security.web.authentication.SimpleUrlAuthenticationFailureHandler">
				<beans:property name="defaultFailureUrl" value="/faces/Welcome.xhtml" />
			</beans:bean>
		</beans:property>
    </beans:bean>

    <!--My custom auth manager-->
    <beans:bean id="myAuthenticationManager" class="com.hrs.tgo.overview.security.MyAuthenticationManager">
        <beans:constructor-arg>
            <beans:ref bean="userService"/>
        </beans:constructor-arg>
    </beans:bean>

    <!--My authentication entry point, can be replaced easily if we are doing custom commence of invalid auths.-->
    <!--<beans:bean id="myAuthenticaionEntryPoint" class="com.hrs.tgo.overview.security.MyAuthenticationEntryPoint">-->
    <beans:bean id="authenticaionEntryPoint" class="org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint">
        <beans:property name="loginFormUrl" value="/faces/Welcome.xhtml" />
	</beans:bean>



</beans:beans>